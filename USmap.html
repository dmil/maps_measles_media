<!DOCTYPE HTML>

<html>
	<head>
		<title>United States Map</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<link rel="stylesheet" href="styles/styles.css" />
	</head>
	<body class="subpage">

		<!-- Header -->
			<header id="header">
				<div class="inner">
					<a href="index.html" class="logo">Maps, Measles, and Media</a>
					<nav id="nav">
						<a href="index.html">Home</a>
						<a href="USmap.html">US Spatial</a>
						<a href="ustemp/UStemp.html">US Temporal</a>
						<a href="worldmap.html">Global Spatial</a>
						<a href="worldtemp.html">Global Temporal</a>
					</nav>
					<a href="#navPanel" class="navPanelToggle"><span class="fa fa-bars"></span></a>
				</div>
			</header>

		<!-- Three -->
			<section id="three" class="wrapper">
				<div class="inner">
					<header class="align-center">
						<h2>Measles cases in the US by state</h2>
						<p>Percentage of children with exemptions from vaccine requirements</p>
					</header>
					<p>US state laws require children to have certain vaccines as a prerequisite for entry into daycare and kindergarden. All 50 state allow for medical exemptions from this requirement. Studies have shown that vaccine exemptions tend to cluster geographically, rendering some cummunities particularly vulnerable to outbreaks (Wang et al). Most states (45 and Washington DC) also grant religious exemptions and 15 states allow philosophical exemptions based on other non-religous personal or moral belief (Source: National Conference of State Legislatures, drawing on LexisNexis StateNet Database and the Immunization Action Coalition, May 2019).</p>
					<style>
					body {
					  font: 12px sans-serif;
					}
					 
					.state rect {
					  fill: #a6a8ab;
					}

					.state text {
					  font: 12px sans-serif;
					  font-weight: bold;
					  text-anchor: middle;
					  fill: white;
					}
					  
					.q0-5 rect { fill: #e3d2c7; }
					.q1-5 rect { fill: #e6b5a6; }
					.q2-5 rect { fill: #e98a75; }
					.q3-5 rect { fill: #ed5e44; }
					.q4-5 rect { fill: #ef4123; }
  

					#legend {
					    padding: 1.5em 0 0 1.5em;
					}
					  
					.list-inline {
					    padding-left: 0;
					    list-style: none;
					}
					  
					.list-inline > li {
					  display: inline-block;
					}

					li.key {
					    border-top-width: 15px;
					    border-top-style: solid;
					    font-size: 1em;
					    width: 10%;
					    padding-left: 0;
					    padding-right: 0;
					}
					  
					li.q0-5 { color: #e3d2c7; }
					li.q1-5 { color: #e6b5a6; }
					li.q2-5 { color: #e98a75; }
					li.q3-5 { color: #ed5e44; }
					li.q4-5 { color: #ef4123; }

					</style>
					<body>
					<svg width="960" height="500"></svg>
					<script id="grid" type="text/plain">
					                              ME
					               WI          VT NH
					WA ID MT ND MN IL MI    NY MA RI
					OR NV WY SD IA IN OH PA NJ CT
					CA UT CO NE MO KY WV VA MD DE
					   AZ NM KS AR TN NC SC
					         OK LA MS AL GA
					HI AK    TX             FL
					</script>
					<script src="jenks.js"></script>
					<script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/3.10.1/lodash.js"></script>
					<script src="//d3js.org/d3.v3.min.js"></script>
					<script>

					var states = [],
					    //
					    // EDIT!
					    //
					    dataKey = 'exemption rate',
					    //
					    // DON'T EDIT!
					    //
					    stateKey = 'state abbreviation',
					    rowsArr = [
					    {
					        "state": "Alabama",
					        "state abbreviation": "AL",
					        "exemption rate": "0.8"
					    },
					    {
					        "state": "Alaska",
					        "state abbreviation": "AK",
					        "exemption rate": "7.1"
					    },
					    {
					        "state": "Arizona",
					        "state abbreviation": "AZ",
					        "exemption rate": "6"
					    },
					    {
					        "state": "Arkansas",
					        "state abbreviation": "AR",
					        "exemption rate": "1.8"
					    },
					    {
					        "state": "California",
					        "state abbreviation": "CA",
					        "exemption rate": "0.6"
					    },
					    {
					        "state": "Colorado",
					        "state abbreviation": "CO",
					        "exemption rate": "4.9"
					    },
					    {
					        "state": "Connecticut",
					        "state abbreviation": "CT",
					        "exemption rate": "2.7"
					    },
					    {
					        "state": "Delaware",
					        "state abbreviation": "DE",
					        "exemption rate": "1.2"
					    },
					    {
					        "state": "Florida",
					        "state abbreviation": "FL",
					        "exemption rate": "3.2"
					    },
					    {
					        "state": "Georgia",
					        "state abbreviation": "GA",
					        "exemption rate": "2.5"
					    },
					    {
					        "state": "Hawaii",
					        "state abbreviation": "HI",
					        "exemption rate": "4.4"
					    },
					    {
					        "state": "Idaho",
					        "state abbreviation": "ID",
					        "exemption rate": "7.7"
					    },
					    {
					        "state": "Illinois",
					        "state abbreviation": "IL",
					        "exemption rate": "1.8"
					    },
					    {
					        "state": "Indiana",
					        "state abbreviation": "IN",
					        "exemption rate": "1.3"
					    },
					    {
					        "state": "Iowa",
					        "state abbreviation": "IA",
					        "exemption rate": "2.4"
					    },
					    {
					        "state": "Kansas",
					        "state abbreviation": "KS",
					        "exemption rate": "2.1"
					    },
					    {
					        "state": "Kentucky",
					        "state abbreviation": "KY",
					        "exemption rate": "1.4"
					    },
					    {
					        "state": "Louisiana",
					        "state abbreviation": "LA",
					        "exemption rate": "1.2"
					    },
					    {
					        "state": "Maine",
					        "state abbreviation": "ME",
					        "exemption rate": "6.2"
					    },
					    {
					        "state": "Maryland",
					        "state abbreviation": "MD",
					        "exemption rate": "1.5"
					    },
					    {
					        "state": "Massachusetts",
					        "state abbreviation": "MA",
					        "exemption rate": "1.4"
					    },
					    {
					        "state": "Michigan",
					        "state abbreviation": "MI",
					        "exemption rate": "4.5"
					    },
					    {
					        "state": "Minnesota",
					        "state abbreviation": "MN",
					        "exemption rate": "3.7"
					    },
					    {
					        "state": "Mississippi",
					        "state abbreviation": "MS",
					        "exemption rate": "0.1"
					    },
					    {
					        "state": "Missouri",
					        "state abbreviation": "MO",
					        "exemption rate": "2.7"
					    },
					    {
					        "state": "Montana",
					        "state abbreviation": "MT",
					        "exemption rate": "4.5"
					    },
					    {
					        "state": "Nebraska",
					        "state abbreviation": "NE",
					        "exemption rate": "2.1"
					    },
					    {
					        "state": "Nevada",
					        "state abbreviation": "NV",
					        "exemption rate": "3.3"
					    },
					    {
					        "state": "New Hampshire",
					        "state abbreviation": "NH",
					        "exemption rate": "3.3"
					    },
					    {
					        "state": "New Jersey",
					        "state abbreviation": "NJ",
					        "exemption rate": "2.5"
					    },
					    {
					        "state": "New Mexico",
					        "state abbreviation": "NM",
					        "exemption rate": "1.5"
					    },
					    {
					        "state": "New York",
					        "state abbreviation": "NY",
					        "exemption rate": "1.3"
					    },
					    {
					        "state": "North Carolina",
					        "state abbreviation": "NC",
					        "exemption rate": "1.6"
					    },
					    {
					        "state": "North Dakota",
					        "state abbreviation": "ND",
					        "exemption rate": "4.3"
					    },
					    {
					        "state": "Ohio",
					        "state abbreviation": "OH",
					        "exemption rate": "2.9"
					    },
					    {
					        "state": "Oklahoma",
					        "state abbreviation": "OK",
					        "exemption rate": "2.6"
					    },
					    {
					        "state": "Oregon",
					        "state abbreviation": "OR",
					        "exemption rate": "7.7"
					    },
					    {
					        "state": "Pennsylvania",
					        "state abbreviation": "PA",
					        "exemption rate": "2.9"
					    },
					    {
					        "state": "Rhode Island",
					        "state abbreviation": "RI",
					        "exemption rate": "1.3"
					    },
					    {
					        "state": "South Carolina",
					        "state abbreviation": "SC",
					        "exemption rate": "2.6"
					    },
					    {
					        "state": "South Dakota",
					        "state abbreviation": "SD",
					        "exemption rate": "2.6"
					    },
					    {
					        "state": "Tennessee",
					        "state abbreviation": "TN",
					        "exemption rate": "1.9"
					    },
					    {
					        "state": "Texas",
					        "state abbreviation": "TX",
					        "exemption rate": "2.4"
					    },
					    {
					        "state": "Utah",
					        "state abbreviation": "UT",
					        "exemption rate": "5.7"
					    },
					    {
					        "state": "Vermont",
					        "state abbreviation": "VT",
					        "exemption rate": "4.7"
					    },
					    {
					        "state": "Virginia",
					        "state abbreviation": "VA",
					        "exemption rate": "1.7"
					    },
					    {
					        "state": "Washington",
					        "state abbreviation": "WA",
					        "exemption rate": "5"
					    },
					    {
					        "state": "West Virginia",
					        "state abbreviation": "WV",
					        "exemption rate": "0.8"
					    },
					    {
					        "state": "Wisconsin",
					        "state abbreviation": "WI",
					        "exemption rate": "5.9"
					    },
					    {
					        "state": "Wyoming",
					        "state abbreviation": "WY",
					        "exemption rate": "2.9"
					    }
					]

					d3.select("#grid").text().split("\n").forEach(function(line, i) {
					  var re = /\w+/g, m;
					  while (m = re.exec(line)) {
					    states.push({
					      name: m[0],
					      data: _.result(_.findWhere(rowsArr, { 'state abbreviation': m[0]}), dataKey),
					      x: m.index / 3,
					      y: i
					    });
					  }
					});

					var svg = d3.select("svg"),
					    width = +svg.attr("width"),
					    height = +svg.attr("height");

					var gridWidth = d3.max(states, function(d) { return d.x; }) + 1,
					    gridHeight = d3.max(states, function(d) { return d.y; }) + 1,
					    cellSize = 40;

					var nestedData = d3.nest()
					    .key(function(d) { return d.stateAbbrev; })
					    .entries(rowsArr);

					var mappedData = function mappedValues(key) {
					  return rowsArr.map(function(stateObj) {
					    return stateObj[dataKey]
					  })
					}
					console.log(mappedData(stateKey))
					console.log(dataKey)
					var currScale = d3.scale.quantile()
					      .domain(d3.range(1,14))
					      .range(d3.range(5).map(function(i) { return "q" + i + "-5"; }));

					var state = svg.append("g")
					    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
					  .selectAll(".state")
					    .data(states)
					  .enter().append("g")
					    .attr("transform", function(d) { return "translate(" + (d.x - gridWidth / 2) * cellSize + "," + (d.y - gridHeight / 2) * cellSize + ")"; })
					    .attr("class", function(d) {
					      var currData = d.data,
					          currClassStr = '';
					      if (currData !== null) {
					        currClassStr += "state " + currScale(d.data)
					      } else {
					        currClassStr += "state"
					      }
					      return currClassStr;
					    });

					state.append("rect")
					    .attr("x", -cellSize / 2)
					    .attr("y", -cellSize / 2)
					    .attr("width", cellSize - 1)
					    .attr("height", cellSize - 1);

					state.append("text")
					    .attr("dy", ".35em")
					    .text(function(d) { return d.name; });
					  
					var legend = d3.select('body')
					  .insert('div', ":first-child")
					    .attr("id", "legend")
					  .append('ul')
					    .attr('class', 'list-inline');

					var keys = legend.selectAll('li.key')
					    .data(currScale.range());

					keys.enter().append('li')
					    .attr('class', function(d) { return'key ' + d; })
					    .style('border-top-color', String)
					    .text(function(d) {
					  			var format = d3.format('.1%');
					        var r = currScale.invertExtent(d);
					        return format(r[0]/100);
					    });

					</script>

					<p>Source: Seither R, Loretan C, Driver K, Mellerson JL, Knighton CL, Black CL. Vaccination Coverage with Selected Vaccines and Exemption Rates Among Children in Kindergarten - United States, 2018-2019 School Year. MMWR Morb Mortal Wkly Rep 2019;68:905-912. DOI: http:dx.doi.org/10.15585/mmwr.mm6841e1.</p>
					<div class="flex flex-2">
						<!--<article>
							<div class="image fit">
								<img src="images/pic01.jpg" alt="Pic 01" />
							</div>
							<header>
								<h3>Vaccination rates by state</h3>
							</header>
							<p>I am a paragraph.</p>
							<footer>
								<a href="#" class="button special">More</a>
							</footer>
						</article>
						<article>
							<div class="image fit">
								<img src="images/pic02.jpg" alt="Pic 02" />
							</div>
							<header>
								<h3>Measles cases by state</h3>
							</header>
							<p>I am another paragraph.</p>
							<footer>
								<a href="#" class="button special">More</a>
							</footer>
						</article>-->
					</div>
				</div>
			</section>

		<!-- Footer -->
			<footer id="footer">
				<div class="inner">
					<div class="flex">
						<div class="copyright">
							&copy; Maps, Measles, and Media. Design: <a href="https://templated.co">TEMPLATED</a>. Images: <a href="https://unsplash.com">Unsplash</a>.
						</div>
						<ul class="icons">
							<li><a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a></li>
							<li><a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a></li>
							<li><a href="#" class="icon fa-linkedin"><span class="label">linkedIn</span></a></li>
							<li><a href="#" class="icon fa-pinterest-p"><span class="label">Pinterest</span></a></li>
							<li><a href="#" class="icon fa-vimeo"><span class="label">Vimeo</span></a></li>
						</ul>
					</div>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/skel.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>